<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>q1's simple point n clicker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Mono:ital,wght@0,200..800;1,200..800&display=swap');

        html, body {
            margin: 0;
            background: black;
        }
        body {
            display: flex;
            width: 100vw;
            height: 100vh;
            color: white;
        }
        header, footer, main {
            height: 100%;
        }
        main, aside {
            width: 100%;
        }
        main, aside {
            display: flex;
            gap: 5px;
            flex-direction: column;
        }
        header, footer {
            display: flex;
            flex-direction: column;
        }
        header {
            padding-bottom: 5px;
            padding-top: 5px;
            justify-content: space-between;
        }
        aside {
            padding: 5px;
            overflow-y: scroll;
            scrollbar-color: gray black;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        canvas.grab {
            cursor: grab;
        }

        body {
            font-size: 13px;
            font-family: "Atkinson Hyperlegible Mono", monospace;
        }
        input, button, select, textarea {
            font-size: inherit;
            font-family: inherit;
            line-height: inherit;
            color: inherit;
            background: transparent;
            border: 1px solid gray;
        }
        select.default {
            color: gray;
            font-style: italic;
        }
        input:focus, button:focus, summary:focus, select:focus, textarea:focus {
            outline: none;
            border: 1px solid greenyellow;
        }
        input::placeholder {
            font-style: italic;
        }
        button:active, input[type="button"]:active {
            font-style: italic;
            background: greenyellow;
            color: black;
        }
        button[disabled] {
            background: transparent;
            color: gray;
            font-style: italic;
        }
        button.delete {
            color: red;
            border-color: red;
        }
        aside > ul {
            padding: 0;
        }
        ul {
            margin: 5px;
            padding-left: 4ch;
            list-style-type: "- ";
        }
        .folder {
            user-select: none;
            list-style-type: "";
        }
        summary:hover, .file.loaded:hover {
            background: rgba(255, 255, 255, .2);
        }
        .file {
            color: gray;
        }
        .file.loaded {
            color: white;
            cursor: grab;
        }
        
        .dropzone {
            width: 100%;
            text-align: center;
            color: gray;
            border: 1px dashed gray;
            padding: 1em;
            box-sizing: border-box;
            background-repeat: no-repeat;
            background-position: center;
        }
        body.dragging .dropzone:hover {
            border-style: solid;
            border-color: greenyellow;
            color: white;
        }

        #_objectmenu {
            width: 100%;
        }
        textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 5px;
            resize: none;
        }
        img {
            max-width: 100%;
            image-rendering: pixelated;
        }

        #_dialoguetypes {
            padding: 0;
        }

        .expand {
            flex-grow: 1;
        }
        .hidden {
            display: none;
        }
        .flex {
            display: flex;
            gap: 5px;
        }
        body.dragging, body.dragging * {
            cursor: grabbing;
        }
        body.delete-object main, body.delete-object aside {
            background: red;
            scrollbar-color: gray red;
        }
        body.game canvas {
            cursor: none;
        }

        dialog {
            color: white;
            border: none;
            background: transparent;
            outline: none;
            max-width: 50em;
        }
        dialog::backdrop {
            background: rgba(0, 0, 0, .9);
        }
    </style>
    <script src="FileSaver.min.js" defer></script>
    <script src="jszip.min.js" defer></script>
    <script src="game/util.js" defer></script>
    <script src="game/sprite.js" defer></script>
    <script src="game/dialogue.js" defer></script>
    <script src="game/game.js" defer></script>
</head>
<body>

    <aside>
        <div class="flex">
            <button type="button" class="expand" onclick="this.nextElementSibling.click()">load</button>
                <input type="file" class="hidden" accept=".spnc" onchange="loadGame(this.files[0])" id="_loadbutton">
            <button type="button" class="expand" onclick="saveGame()">save</button>
            <button type="button" class="expand" onclick="exportGame()">export game</button>
        </div>
        <button type="button" onclick="loadAssetFolder()" title="(re)load asset folder">(re)load an asset folder</button>
        <ul id="_filesystem"></ul>
    </aside>
    <main>
        <header>
            <center style="color: gray">q1's simple point n clicker v0</center style="color: gray">
            <div class="flex">
                <button type="button" id="_modebutton" onclick="switchMode()" title="change mode [tab]">EDITOR MODE</button>
                <div class="expand"></div>
                <select id="_sceneselect" value="main" title="current scene / scene select" onchange="game.setScene(this.value)"></select>
                <button type="button" onclick="_help.showModal()" title="help">?</button>
            </div>
        </header>
        <canvas id="canvas" width="800" height="600"></canvas>
        <footer>
            <div class="flex expand">
                <div>
                    <input min="1" max="3000" type="number" id="_gamewidth" onchange="game.setSize(parseInt(this.value))" title="game width">
                    x
                    <input min="1" max="3000" type="number" id="_gameheight" onchange="game.setSize(null, parseInt(this.value))" title="game height">
                </div>
                <div class="expand"></div>
                <div id="_hoveralt"></div>
            </div>
        </footer>
    </main>
    <aside id="_objectmenu" class="hidden">
        <div>:: SCRIPT FOR <em id="_objectname"></em></div>
        <textarea id="_objectscript" title="object script"></textarea>
        <img id="_objectpreview" src="" title="selected object" alt="selected object">
    </aside>
    <aside id="_gamemenu">
        :: SCENE
        <div class="dropzone" id="_scenebg" onmouseup="setSceneBackground()" title="drop background image here">background image</div>
        <div class="flex">
            <input id="_scenename" type="text" title="new scene name" class="expand" placeholder="id" onkeyup="if(event.key==='Enter')this.nextElementSibling.click()">
            <button type="button" onclick="addScene()" title="create scene">+</button>
        </div>
        <button type="button" class="delete" onclick="deleteScene()">delete scene</button>
        <br>
        :: CURSOR
        <div class="flex">
            <div class="dropzone" id="_cursordefault" style="background-image: url(_res/cursor_open.png)" onmouseup="setCursorDefault()" title="drop default cursor image here">cursor (default)</div>
            <div class="dropzone" id="_cursordown" style="background-image: url(_res/cursor_closed.png)" onmouseup="setCursorDown()" title="drop held cursor image here">cursor (down)</div>
        </div>
        <div>
            <br>
            :: SFX
            <ul id="_soundslist"></ul>
            <div class="flex">
                <input id="_sfxname" type="text" placeholder="id" class="expand" title="new sound name" onkeyup="if(event.key==='Enter')this.nextElementSibling.nextElementSibling.click()">
                <div id="_sfxdropzone" class="dropzone" onmouseup="selectSound()" title="drop sound file here">file (mp3, wav, ogg)</div>
                <button type="button" onclick="addSound()" title="create sound">+</button>
            </div>
        </div>
        <div>
            <br>
            :: DIALOGUE TYPES
            <ul id="_dialoguetypes"></ul>
            <div class="flex">
                <input type="text" placeholder="id" class="expand" title="new type name" onkeyup="if(event.key==='Enter')this.nextElementSibling.click()">
                <button type="button" title="create type" onclick="addDialogueType(this.previousElementSibling.value); this.previousElementSibling.value = ''">+</button>
            </div>
        </div>
        <br>
        <div class="expand"></div>
        <div style="text-align: right">
            <input type="checkbox" onchange="editor.disablePrompts=this.checked" checked /> disable confirmation prompts
        </div>
    </aside>

    <dialog id="_nofileapi">
        your browser doesn't support the File System API. this tool won't work without it.<br>
        <br>
        <button type="button" onclick="this.parentElement.close()">access anyway</button>
    </dialog>

    <dialog id="_help">
        <p>
            this is a tool for making mechanically simple point n click games. my intention is that you'd collect a bunch of assets (sounds, images), dump them into a folder, and load that folder in to collage together a little game.
        </p>
        <p>
            a basic scripting system allows for playing sounds, moving between scenes, and playing text:
            <ul>
                <li><em>PLAY:</em> to play a sound</li>
                <li><em>STOP:</em> to stop a sound</li>
                <li><em>GOTO:</em> to go to a different scene</li>
                <li><em>[TYPE]:</em> to display text using a specific dialogue type</li>
            </ul>
        </p>
        <p>
            misc shortcuts:
            <ul>
                <li>TAB to switch between EDITOR MODE and GAME MODE</li>
                <li><em>//</em> to comment in scripts</li>
                <li>SCROLL to scale objects</li>
                <li>RIGHT CLICK to send an object to the back</li>
            </ul>
        </p>
        <br>
        <button type="button" onclick="this.parentElement.close()">close</button>
    </dialog>
    
</body>

<script src="editor.js"></script>
<script>
    window.addEventListener("load", () => {
        for (let el of document.querySelectorAll("*[title]"))
            setLabel(el, el.title);

        document.addEventListener("keydown", e => {
            if (e.key === "Tab") {
                switchMode();
                _modebutton.focus();
                e.preventDefault();
            }
        })

        document.querySelector("textarea").addEventListener("focus", resizeTextarea);
        document.querySelector("textarea").addEventListener("input", resizeTextarea);

        updateScenes();
        updateSounds();

        if (!window.showDirectoryPicker)
            _nofileapi.showModal();
    })
</script>
</html>